<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>File Share</title>
</head>
<body>
<h1> Search Files</h1>
<button class="navButton" id="uploadButton"> Upload </button>
<button class="navButton" id="downloadButton"> Download </button>


<h2> Search </h2>
<label for="file-search"></label><input type="search" id="file-search" name="file-search">
<button id="searchButton">Search</button>

<h2> Search Results </h2>
<ul>
    <% files.forEach(file => { %>
        <li>
            <%= file.filename %>
            <a href="/files/<%= file._id %>/download">Download</a>
        </li>
    <% }) %>
</ul>

<div>
    <% if (page > 1) { %>
        <a href="/search?page=<%= page - 1 %>">Prev</a>
    <% } %>

    <% if (page < totalPages) { %>
        <a href="/search?page=<%= page + 1 %>">Next</a>
    <% } %>
</div>

<script>
    document.getElementById('uploadButton').addEventListener('click', goToUploadPage);
    document.getElementById('downloadButton').addEventListener('click', goToDownloadPage);
    document.getElementById('searchButton').addEventListener('click', searchFiles);

    function goToUploadPage() {
        window.location.href = '/upload'
    }

    function goToDownloadPage() {
        window.location.href = '/download'
    }

    async function searchFiles() {
        const query = document.getElementById('file-search').value.trim();
        const res = await fetch(`/api/search?query=${encodeURIComponent(query)}`);
        const files = await res.json();

        const list = document.querySelector('ul');
        list.innerHTML = '';

        files.forEach(file => {
            const li = document.createElement('li');
            li.innerHTML = `${file.filename} <a href="/files/${file._id}/download">Download</a>`;
            list.appendChild(li);
        });
    }
</script>

</body>
</html>
