<%- include('partials/metadata', {lang: 'en', tabTitle: 'Login'}) %>
<body>
<h1> Login to upload/download files</h1>
<input type="text" placeholder="Username" id="username"/>
<input type="password" placeholder="Password" id="password"/>
<button onclick="login()" id="login button">login</button>
<button onclick="register()" id="register button">register</button>


<script>
    async function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (!username || !password) {
            alert("Username and password are required");
            return;
        }

        const response = await fetch("/sessions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || "Login failed");
            return;
        }

        window.location.href = "/download";
    }

    async function register() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (!username || !password) {
            alert("Username and password are required");
            return;
        }

        const response = await fetch("/users", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ username, password })
        })

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || "Registration failed");
            return;
        }

        alert("Registration successful. Please log in.");
    }
</script>

</body>
