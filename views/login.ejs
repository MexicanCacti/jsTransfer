<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>File Share</title>
</head>
<body>
<h1> Login to upload/download files</h1>
<input type="text" placeholder="Username" id="username"/>
<input type="password" placeholder="Password" id="password"/>
<button onclick="login()" id="login button">login</button>



<script>
    function login(){
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if(!username || !password){
            alert("Please enter username and password");
            return;
        }

    }



    async function downloadProtected(fileId) {
        const password = document.getElementById(`pass-${fileId}`).value;
        if (!password) {
            alert("Password is required");
            return;
        }

        const response = await fetch(`/files/${fileId}/download`, {
            method: 'POST',
            headers: {
                "content-type": "application/json",
            },
            body: JSON.stringify({ password })
        });

        if (!response.ok) {
            alert("Invalid Password");
            return;
        }

        const disposition = response.headers.get("Content-Disposition");
        let filename = "download";

        if (disposition && disposition.includes("filename=")) {
            filename = disposition
                .split("filename=")[1]
                .replace(/"/g, "");
        }

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        window.URL.revokeObjectURL(url);
    }
</script>

</body>
</html>
